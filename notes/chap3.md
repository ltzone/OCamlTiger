---
title: 【OCaml Tiger】Chapter 3 Parser
url: ml-parser
date: 2020-08-15 11:14:13
tags: 
- Modern Compiler Implementation in OCaml

categories: 
- Study

---

[toc]

<!--more-->

Motivation: finite automaton can't recognize balanced parentheses, we need something more powerful than finite automata to parse language described by **grammars**.

## Context-free grammars
- can be userd to define lexical structure in a static, declarative way
- derivations: start with the start symbol, repeatedly replace any non terminal by one of its right-hand sides
  - leftmost derivation: always expand leftmost
  - rightmost derivation: AKA _left-to-right parse_, _LR parse_
- a grammar is **ambiguous** if it can derive with two distinct parse trees
- Usually ambiguity is eliminated by transforming grammar
- EOF Markers are necessary

## Predictive Parsing
1. simple: recursive descent/predictive parsing
   - easy to implement in ML-language (by mutually-recursive functions)
   - only works when *the first terminal of each subexpression provides enough information to choose which production to use*
   - i.e. every righthand side has different `FIRST` sets.




## LR Parsing

## Using parser generators

## Parser error recovery

## Implementation

We use Menhir to generate the parser for Tiger Language. There are a few minor differences between Menhir and Yacc.
- Menhir does not generate a verbose transition table as Yacc does, instead `--explain` generates a `.conflicts` file which may be easier for users to understand and resolve the shift-reduce conflicts.
- The error recovery strategy in menhir does not support annotations like `%change`,`%values`,etc as described in the textbook. Instead, it creates a checkpoint for users to write a function to resolve errors
- [...](http://gallium.inria.fr/~fpottier/menhir/manual.html#sec88)

However, the general syntax and principles are similar. With reference to the *Tiger Language Reference Manual* and [*Menhir Manual*](http://gallium.inria.fr/~fpottier/menhir/manual.html), we can implement the language.

To help you get started, [RealWorldOCaml](https://dev.realworldocaml.org/parsing-with-ocamllex-and-menhir.html) provides a chapter that introduces the workflow of writing a frontend in OCaml.

You should write the parser rules in the `.mly` file, and the `ml` code for parser will be generated by menhir. To configure the environment, make sure you have installed `opam 2.0+` and `ocaml 4.10.0+` in your system.

1. Install Menhir `opam install menhir`
2. Write your `.mly` rules
3. run `menhir parser.mly` to generate the code
4. You may also add switches like `--explain` to test your grammar
5. For now, we may leave the semantic action `{}` after the production empty, we will fill them in the next chapter. As a result, the generated `parser.ml` will not be executable at present.